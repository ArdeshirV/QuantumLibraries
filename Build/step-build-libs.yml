##
# Builds, tests & package all libraries.
##

steps:
##
# Build
##
- task: DotNetCoreCLI@2
  displayName: 'Build Libraries'
  inputs:
    projects: |
      $(LibrariesRootFolder)/Standard.sln
      $(LibrariesRootFolder)/Chemistry.sln
    arguments: '-c $(BuildConfiguration) -v n /p:Version=$(Assembly.Version)'


##
# Test
##
- task: DotNetCoreCLI@2
  displayName: 'Test Libraries'
  inputs:
    command: test
    projects: |
     $(LibrariesRootFolder)/Standard/tests
     $(LibrariesRootFolder)/Chemistry/tests/ChemistryTests/ChemistryTests.csproj
     $(LibrariesRootFolder)/Chemistry/tests/SystemTests/SystemTests.csproj
     $(LibrariesRootFolder)/Chemistry/tests/DataModelTests/DataModelTests.csproj
    arguments: '-c $(BuildConfiguration) -v n /p:Version=$(Assembly.Version)'

##
# Create Nuget.
##
- task: DotNetCoreCLI@2
  displayName: 'Pack Microsoft.Quantum.Standard'
  inputs:
    command: custom
    custom: pack
    projects: |
     $(LibrariesRootFolder)/Standard/src/Standard.csproj
    arguments: >
      --no-build 
      -c $(BuildConfiguration) 
      -v $(Build.Verbosity)
      -o $(System.DefaultWorkingDirectory) 
      /p:Version=$(Assembly.Version)
      /p:PackageVersion=$(Nuget.Version)

- task: DotNetCoreCLI@2
  displayName: 'Pack Microsoft.Quantum.Chemistry'
  inputs:
    command: custom
    custom: pack
    projects: |
     $(LibrariesRootFolder)/Chemistry/src/DataModel/DataModel.csproj
    arguments: >
      --no-build 
      -c $(BuildConfiguration) 
      -v $(Build.Verbosity)
      -o $(System.DefaultWorkingDirectory) 
      /p:Version=$(Assembly.Version)
      /p:PackageVersion=$(Nuget.Version)
